angular.module("angular-easy-image-preloader",[]).factory("preloader",["$q","$rootScope",function(t,e){function i(e){this.imageLocations=e,this.imageCount=this.imageLocations.length,this.loadCount=0,this.errorCount=0,this.states={PENDING:1,LOADING:2,RESOLVED:3,REJECTED:4},this.state=this.states.PENDING,this.deferred=t.defer(),this.promise=this.deferred.promise}return i.preloadImages=function(t){return new i(t).load()},i.prototype={constructor:i,isInitiated:function(){return this.state!==this.states.PENDING},isRejected:function(){return this.state===this.states.REJECTED},isResolved:function(){return this.state===this.states.RESOLVED},load:function(){if(this.isInitiated())return this.promise;this.state=this.states.LOADING;for(var t=0;t<this.imageCount;t++)this.loadImageLocation(this.imageLocations[t]);return this.promise},handleImageError:function(t){this.errorCount++,this.isRejected()||(this.state=this.states.REJECTED,this.deferred.reject(t))},handleImageLoad:function(t){this.loadCount++,this.isRejected()||(this.deferred.notify({percent:Math.ceil(this.loadCount/this.imageCount*100),imageLocation:t}),this.loadCount===this.imageCount&&(this.state=this.states.RESOLVED,this.deferred.resolve(this.imageLocations)))},loadImageLocation:function(t){var i=this,s=angular.element(new Image).bind("load",function(t){e.$apply(function(){i.handleImageLoad(t.target.src),i=s=t=null})}).bind("error",function(t){e.$apply(function(){i.handleImageError(t.target.src),i=s=t=null})}).attr("src",t)}},i}]);